<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analytics Agent</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg-deep:#08080c;--bg-primary:#0f0f14;--bg-card:#16161d;--bg-hover:#1e1e28;
  --bg-input:#1a1a24;--border:#222230;--border-light:#2e2e3e;
  --text-primary:#e8e8f0;--text-secondary:#8888a0;--text-muted:#55556a;
  --accent:#6366f1;--accent-glow:rgba(99,102,241,.25);
  --success:#10b981;--danger:#f43f5e;--warning:#f59e0b;
  --chart-1:#6366f1;--chart-2:#f43f5e;--chart-3:#10b981;--chart-4:#f59e0b;
  --radius:12px;--radius-lg:16px;--radius-sm:8px;
  --font-sans:'DM Sans',system-ui,sans-serif;
  --font-mono:'JetBrains Mono',monospace;
}

html{font-size:15px;scroll-behavior:smooth}
body{
  font-family:var(--font-sans);background:var(--bg-deep);color:var(--text-primary);
  min-height:100vh;overflow:hidden;
}

/* ‚ïê‚ïê‚ïê LAYOUT ‚ïê‚ïê‚ïê */
.app{display:grid;grid-template-columns:320px 1fr;height:100vh;}

/* ‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê */
.sidebar{
  background:var(--bg-primary);border-right:1px solid var(--border);
  display:flex;flex-direction:column;overflow:hidden;
}
.sidebar-header{
  padding:24px 20px 16px;border-bottom:1px solid var(--border);
}
.logo{display:flex;align-items:center;gap:10px;margin-bottom:4px}
.logo-icon{
  width:36px;height:36px;background:linear-gradient(135deg,var(--accent),#8b5cf6);
  border-radius:10px;display:flex;align-items:center;justify-content:center;
  font-size:18px;font-weight:700;color:#fff;
}
.logo-text{font-size:1.15rem;font-weight:700;letter-spacing:-.02em}
.logo-sub{font-size:.72rem;color:var(--text-muted);margin-top:2px;font-weight:400}

/* Upload Zone */
.upload-zone{
  margin:16px 16px 0;padding:28px 16px;border:2px dashed var(--border-light);
  border-radius:var(--radius);text-align:center;cursor:pointer;
  transition:all .25s ease;position:relative;overflow:hidden;
}
.upload-zone:hover,.upload-zone.dragover{
  border-color:var(--accent);background:rgba(99,102,241,.06);
}
.upload-zone.dragover{transform:scale(1.01)}
.upload-icon{font-size:2rem;margin-bottom:8px;opacity:.6}
.upload-title{font-size:.85rem;font-weight:600;margin-bottom:4px}
.upload-sub{font-size:.72rem;color:var(--text-muted)}
.upload-input{display:none}
.upload-progress{
  position:absolute;bottom:0;left:0;height:3px;background:var(--accent);
  transition:width .3s;border-radius:0 3px 0 0;
}

/* Tables List */
.tables-section{flex:1;overflow-y:auto;padding:12px 16px}
.tables-section::-webkit-scrollbar{width:4px}
.tables-section::-webkit-scrollbar-thumb{background:var(--border-light);border-radius:4px}
.section-label{
  font-size:.68rem;font-weight:600;text-transform:uppercase;letter-spacing:.08em;
  color:var(--text-muted);margin-bottom:10px;
}
.table-card{
  background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-sm);
  padding:12px 14px;margin-bottom:8px;cursor:pointer;transition:all .2s;
}
.table-card:hover{border-color:var(--accent);background:var(--bg-hover)}
.table-name{font-family:var(--font-mono);font-size:.82rem;font-weight:600;margin-bottom:4px}
.table-meta{font-size:.7rem;color:var(--text-secondary)}
.table-cols{
  display:flex;flex-wrap:wrap;gap:4px;margin-top:8px;
}
.col-tag{
  font-size:.62rem;font-family:var(--font-mono);background:var(--bg-deep);
  padding:2px 7px;border-radius:4px;color:var(--text-secondary);border:1px solid var(--border);
}

/* Status */
.sidebar-footer{
  padding:12px 16px;border-top:1px solid var(--border);
  display:flex;align-items:center;gap:8px;font-size:.72rem;
}
.status-dot{
  width:8px;height:8px;border-radius:50%;flex-shrink:0;
}
.status-dot.ok{background:var(--success);box-shadow:0 0 6px var(--success)}
.status-dot.err{background:var(--danger);box-shadow:0 0 6px var(--danger)}
.status-text{color:var(--text-secondary)}

/* Clear btn */
.clear-btn{
  margin:0 16px 12px;padding:8px;background:transparent;border:1px solid var(--border);
  border-radius:var(--radius-sm);color:var(--text-secondary);font-size:.72rem;
  cursor:pointer;transition:all .2s;font-family:var(--font-sans);
}
.clear-btn:hover{border-color:var(--danger);color:var(--danger)}

/* ‚ïê‚ïê‚ïê MAIN AREA ‚ïê‚ïê‚ïê */
.main{display:flex;flex-direction:column;overflow:hidden;background:var(--bg-deep)}

/* Chat Header */
.chat-header{
  padding:16px 28px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:var(--bg-primary);
}
.chat-title{font-size:.95rem;font-weight:600}
.tool-badges{display:flex;gap:6px}
.tool-badge{
  font-size:.6rem;font-family:var(--font-mono);padding:3px 8px;
  border-radius:20px;border:1px solid var(--border);color:var(--text-muted);
  background:var(--bg-card);
}

/* Messages Area */
.messages{
  flex:1;overflow-y:auto;padding:24px 28px;
  display:flex;flex-direction:column;gap:20px;
  scroll-behavior:smooth;
}
.messages::-webkit-scrollbar{width:6px}
.messages::-webkit-scrollbar-thumb{background:var(--border);border-radius:6px}

/* Welcome */
.welcome{
  text-align:center;padding:60px 40px;animation:fadeUp .6s ease;
}
.welcome-icon{font-size:3rem;margin-bottom:16px;opacity:.7}
.welcome h2{font-size:1.4rem;font-weight:700;margin-bottom:8px;letter-spacing:-.02em}
.welcome p{color:var(--text-secondary);font-size:.85rem;max-width:460px;margin:0 auto 24px;line-height:1.6}
.suggestions{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;max-width:600px;margin:0 auto}
.suggestion{
  font-size:.75rem;padding:8px 14px;background:var(--bg-card);border:1px solid var(--border);
  border-radius:20px;cursor:pointer;transition:all .2s;color:var(--text-secondary);
}
.suggestion:hover{border-color:var(--accent);color:var(--text-primary);background:var(--bg-hover)}

/* Message Bubbles */
.msg{display:flex;gap:12px;max-width:900px;animation:fadeUp .35s ease}
.msg.user{flex-direction:row-reverse;align-self:flex-end}
.msg-avatar{
  width:32px;height:32px;border-radius:10px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;font-size:.85rem;
  margin-top:2px;
}
.msg.assistant .msg-avatar{background:linear-gradient(135deg,var(--accent),#8b5cf6);color:#fff}
.msg.user .msg-avatar{background:var(--bg-card);border:1px solid var(--border)}
.msg-body{flex:1;min-width:0}
.msg-content{
  padding:14px 18px;border-radius:var(--radius);font-size:.88rem;line-height:1.65;
}
.msg.assistant .msg-content{background:var(--bg-card);border:1px solid var(--border)}
.msg.user .msg-content{background:var(--accent);color:#fff;border-radius:var(--radius) 4px var(--radius) var(--radius)}
.msg-meta{
  display:flex;gap:8px;margin-top:6px;font-size:.65rem;color:var(--text-muted);
  align-items:center;
}
.msg.user .msg-meta{flex-direction:row-reverse}

/* Tools Used */
.tools-used{display:flex;gap:4px;flex-wrap:wrap;margin-top:8px}
.tool-pill{
  font-size:.6rem;font-family:var(--font-mono);padding:2px 8px;
  border-radius:4px;background:rgba(99,102,241,.1);color:var(--accent);
  border:1px solid rgba(99,102,241,.2);
}

/* Charts in messages */
.msg-charts{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}
.msg-chart{
  border-radius:var(--radius-sm);overflow:hidden;border:1px solid var(--border);
  background:var(--bg-deep);max-width:100%;cursor:pointer;transition:transform .2s;
}
.msg-chart:hover{transform:scale(1.02)}
.msg-chart img{display:block;max-width:100%;height:auto}

/* Data Table */
.msg-table-wrap{
  margin-top:12px;overflow-x:auto;border:1px solid var(--border);
  border-radius:var(--radius-sm);max-height:300px;overflow-y:auto;
}
.msg-table{
  width:100%;border-collapse:collapse;font-size:.75rem;font-family:var(--font-mono);
}
.msg-table th{
  padding:8px 12px;background:var(--bg-hover);color:var(--text-secondary);
  text-align:left;position:sticky;top:0;font-weight:600;border-bottom:1px solid var(--border);
}
.msg-table td{
  padding:6px 12px;border-bottom:1px solid var(--border);color:var(--text-primary);
}
.msg-table tr:hover td{background:rgba(99,102,241,.04)}

/* Typing indicator */
.typing{display:flex;gap:4px;padding:14px 18px}
.typing span{
  width:7px;height:7px;border-radius:50%;background:var(--text-muted);
  animation:bounce .6s infinite alternate;
}
.typing span:nth-child(2){animation-delay:.15s}
.typing span:nth-child(3){animation-delay:.3s}

/* Input Area */
.input-area{
  padding:16px 28px 20px;border-top:1px solid var(--border);
  background:var(--bg-primary);
}
.input-wrap{
  display:flex;gap:10px;align-items:flex-end;
  background:var(--bg-input);border:1px solid var(--border);
  border-radius:var(--radius);padding:6px 6px 6px 16px;
  transition:border-color .2s;
}
.input-wrap:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow)}
.input-wrap textarea{
  flex:1;background:transparent;border:none;outline:none;
  color:var(--text-primary);font-family:var(--font-sans);font-size:.88rem;
  resize:none;line-height:1.5;padding:8px 0;max-height:120px;
}
.input-wrap textarea::placeholder{color:var(--text-muted)}
.send-btn{
  width:40px;height:40px;border-radius:10px;border:none;
  background:var(--accent);color:#fff;cursor:pointer;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  transition:all .2s;font-size:1.1rem;
}
.send-btn:hover{background:#818cf8;transform:scale(1.05)}
.send-btn:disabled{opacity:.3;cursor:not-allowed;transform:none}

/* Lightbox */
.lightbox{
  position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:1000;
  display:none;align-items:center;justify-content:center;
  cursor:pointer;backdrop-filter:blur(8px);
}
.lightbox.show{display:flex}
.lightbox img{max-width:92vw;max-height:92vh;border-radius:var(--radius)}

/* Animations */
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes bounce{to{transform:translateY(-6px);opacity:.4}}
@keyframes spin{to{transform:rotate(360deg)}}

/* Responsive */
@media(max-width:768px){
  .app{grid-template-columns:1fr}
  .sidebar{display:none}
}
</style>
</head>
<body>

<div class="app">
  <!-- ‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-icon">A</div>
        <div>
          <div class="logo-text">Analytics Agent</div>
          <div class="logo-sub">Upload ¬∑ Analyze ¬∑ Discover</div>
        </div>
      </div>
    </div>

    <!-- Upload -->
    <div class="upload-zone" id="uploadZone">
      <div class="upload-icon">üìÇ</div>
      <div class="upload-title">Drop CSV files here</div>
      <div class="upload-sub">or click to browse ¬∑ any size</div>
      <input type="file" class="upload-input" id="fileInput" multiple accept=".csv">
      <div class="upload-progress" id="uploadProgress"></div>
    </div>

    <!-- Tables -->
    <div class="tables-section" id="tablesSection">
      <div class="section-label">Loaded Tables</div>
      <div id="tablesList">
        <div style="color:var(--text-muted);font-size:.78rem;padding:8px 0">No tables loaded yet</div>
      </div>
    </div>

    <button class="clear-btn" id="clearBtn">üóë Clear All Data</button>

    <div class="sidebar-footer">
      <div class="status-dot" id="statusDot"></div>
      <span class="status-text" id="statusText">Checking...</span>
    </div>
  </aside>

  <!-- ‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê -->
  <main class="main">
    <div class="chat-header">
      <div class="chat-title">Chat</div>
      <div class="tool-badges">
        <span class="tool-badge">SQL</span>
        <span class="tool-badge">Charts</span>
        <span class="tool-badge">Profile</span>
        <span class="tool-badge">Anomaly</span>
        <span class="tool-badge">Compare</span>
        <span class="tool-badge">Trend</span>
        <span class="tool-badge">Correlation</span>
      </div>
    </div>

    <div class="messages" id="messages">
      <div class="welcome" id="welcome">
        <div class="welcome-icon">üß†</div>
        <h2>Analytics Agent</h2>
        <p>Upload your CSV files, then ask questions in natural language. I'll auto-select the right analysis tools, generate charts, and surface insights.</p>
        <div class="suggestions" id="suggestions">
          <div class="suggestion" data-q="Show me a bar chart of revenue by region">üìä Revenue by region</div>
          <div class="suggestion" data-q="Compare salary across departments">‚öñÔ∏è Compare salaries</div>
          <div class="suggestion" data-q="Find anomalies in revenue">üîç Find anomalies</div>
          <div class="suggestion" data-q="Show the revenue trend over time">üìà Revenue trend</div>
          <div class="suggestion" data-q="What correlations exist in employee data?">üîó Find correlations</div>
          <div class="suggestion" data-q="Profile the sales table">üìã Profile table</div>
          <div class="suggestion" data-q="Show a pie chart of customers by segment">ü•ß Customer segments</div>
          <div class="suggestion" data-q="What are the top 5 products by total revenue?">üèÜ Top products</div>
        </div>
      </div>
    </div>

    <div class="input-area">
      <div class="input-wrap">
        <textarea id="chatInput" rows="1" placeholder="Ask anything about your data..." disabled></textarea>
        <button class="send-btn" id="sendBtn" disabled>‚û§</button>
      </div>
    </div>
  </main>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <img id="lightboxImg" src="">
</div>

<script>
// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
const API = '';
let isProcessing = false;
let hasData = false;

// ‚ïê‚ïê‚ïê DOM ‚ïê‚ïê‚ïê
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const messagesEl = $('#messages');
const chatInput = $('#chatInput');
const sendBtn = $('#sendBtn');
const uploadZone = $('#uploadZone');
const fileInput = $('#fileInput');
const tablesList = $('#tablesList');
const statusDot = $('#statusDot');
const statusText = $('#statusText');
const lightbox = $('#lightbox');
const lightboxImg = $('#lightboxImg');
const uploadProgress = $('#uploadProgress');

// ‚ïê‚ïê‚ïê HEALTH CHECK ‚ïê‚ïê‚ïê
async function checkHealth() {
  try {
    const r = await fetch(`${API}/api/health`);
    const d = await r.json();
    statusDot.className = 'status-dot ' + (d.ollama ? 'ok' : 'err');
    statusText.textContent = d.ollama
      ? `${d.model} ¬∑ ${d.tables} tables`
      : `Ollama offline ¬∑ ${d.model}`;
    if (d.tables > 0) {
      hasData = true;
      chatInput.disabled = false;
      sendBtn.disabled = false;
      loadTables();
    }
  } catch(e) {
    statusDot.className = 'status-dot err';
    statusText.textContent = 'Server offline';
  }
}

// ‚ïê‚ïê‚ïê TABLES ‚ïê‚ïê‚ïê
async function loadTables() {
  try {
    const r = await fetch(`${API}/api/tables`);
    const d = await r.json();
    const tables = d.tables || {};
    if (Object.keys(tables).length === 0) {
      tablesList.innerHTML = '<div style="color:var(--text-muted);font-size:.78rem;padding:8px 0">No tables loaded yet</div>';
      return;
    }
    tablesList.innerHTML = '';
    for (const [name, info] of Object.entries(tables)) {
      const card = document.createElement('div');
      card.className = 'table-card';
      card.innerHTML = `
        <div class="table-name">${name}</div>
        <div class="table-meta">${info.rows?.toLocaleString() || '?'} rows ¬∑ ${info.columns?.length || '?'} columns</div>
        <div class="table-cols">${(info.columns || []).slice(0, 8).map(c => `<span class="col-tag">${c}</span>`).join('')}${(info.columns || []).length > 8 ? `<span class="col-tag">+${info.columns.length - 8}</span>` : ''}</div>
      `;
      card.onclick = () => sendMessage(`Profile the ${name} table`);
      tablesList.appendChild(card);
    }
  } catch(e) { console.error('loadTables', e); }
}

// ‚ïê‚ïê‚ïê FILE UPLOAD ‚ïê‚ïê‚ïê
uploadZone.onclick = () => fileInput.click();
fileInput.onchange = () => { if (fileInput.files.length) uploadFiles(fileInput.files); };

['dragenter','dragover'].forEach(e => uploadZone.addEventListener(e, ev => {
  ev.preventDefault(); uploadZone.classList.add('dragover');
}));
['dragleave','drop'].forEach(e => uploadZone.addEventListener(e, ev => {
  ev.preventDefault(); uploadZone.classList.remove('dragover');
}));
uploadZone.addEventListener('drop', ev => {
  ev.preventDefault();
  const files = [...ev.dataTransfer.files].filter(f => f.name.endsWith('.csv'));
  if (files.length) uploadFiles(files);
});

async function uploadFiles(files) {
  const fd = new FormData();
  for (const f of files) fd.append('files', f);

  uploadProgress.style.width = '30%';
  uploadZone.querySelector('.upload-title').textContent = 'Uploading...';

  try {
    const r = await fetch(`${API}/api/upload`, { method: 'POST', body: fd });
    uploadProgress.style.width = '100%';
    const d = await r.json();

    const results = d.results || [];
    const msgs = results.map(r =>
      r.error ? `‚ùå ${r.file}: ${r.error}` : `‚úÖ ${r.table} ‚Äî ${r.rows?.toLocaleString()} rows, ${r.columns?.length} columns (${r.size_mb} MB)`
    );

    addMessage('assistant', '**Data Loaded**\n\n' + msgs.join('\n') + '\n\nYou can now ask questions about your data!');

    hasData = true;
    chatInput.disabled = false;
    sendBtn.disabled = false;
    loadTables();
    checkHealth();
    $('#welcome')?.remove();
  } catch(e) {
    addMessage('assistant', '‚ùå Upload failed: ' + e.message);
  } finally {
    setTimeout(() => { uploadProgress.style.width = '0'; }, 500);
    uploadZone.querySelector('.upload-title').textContent = 'Drop CSV files here';
    fileInput.value = '';
  }
}

// ‚ïê‚ïê‚ïê CHAT ‚ïê‚ïê‚ïê
chatInput.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
});
chatInput.addEventListener('input', () => {
  chatInput.style.height = 'auto';
  chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
});
sendBtn.onclick = () => sendMessage();

// Suggestions
document.addEventListener('click', e => {
  if (e.target.classList.contains('suggestion')) {
    sendMessage(e.target.dataset.q);
  }
});

async function sendMessage(text) {
  const msg = text || chatInput.value.trim();
  if (!msg || isProcessing) return;

  $('#welcome')?.remove();
  addMessage('user', msg);
  chatInput.value = '';
  chatInput.style.height = 'auto';

  isProcessing = true;
  sendBtn.disabled = true;
  const typingEl = showTyping();

  try {
    const r = await fetch(`${API}/api/chat`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: msg }),
    });
    const d = await r.json();
    typingEl.remove();

    if (d.error) {
      addMessage('assistant', '‚ùå ' + d.error);
    } else {
      addMessage('assistant', d.answer, {
        charts: d.charts || [],
        tools: d.tools_used || [],
        intents: d.intents || [],
        data_table: d.data_table,
      });
    }
  } catch(e) {
    typingEl.remove();
    addMessage('assistant', '‚ùå Error: ' + e.message);
  } finally {
    isProcessing = false;
    sendBtn.disabled = false;
    chatInput.focus();
  }
}

function addMessage(role, text, extra = {}) {
  const div = document.createElement('div');
  div.className = `msg ${role}`;

  const avatar = role === 'assistant' ? 'üß†' : 'üë§';
  const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

  let html = `
    <div class="msg-avatar">${avatar}</div>
    <div class="msg-body">
      <div class="msg-content">${formatText(text)}</div>
  `;

  // Charts
  if (extra.charts && extra.charts.length) {
    html += '<div class="msg-charts">';
    for (const c of extra.charts) {
      html += `<div class="msg-chart" onclick="openLightbox('${c}')"><img src="${c}" loading="lazy"></div>`;
    }
    html += '</div>';
  }

  // Data table
  if (extra.data_table && extra.data_table.rows && extra.data_table.rows.length) {
    const dt = extra.data_table;
    html += '<div class="msg-table-wrap"><table class="msg-table"><thead><tr>';
    for (const col of dt.columns) html += `<th>${col}</th>`;
    html += '</tr></thead><tbody>';
    for (const row of dt.rows) {
      html += '<tr>';
      for (const col of dt.columns) {
        let val = row[col];
        if (typeof val === 'number') val = val.toLocaleString(undefined, {maximumFractionDigits: 2});
        html += `<td>${val ?? ''}</td>`;
      }
      html += '</tr>';
    }
    html += '</tbody></table></div>';
  }

  // Tools used
  if (extra.tools && extra.tools.length) {
    html += '<div class="tools-used">';
    for (const t of extra.tools) html += `<span class="tool-pill">${t}</span>`;
    html += '</div>';
  }

  html += `<div class="msg-meta"><span>${time}</span></div></div>`;
  div.innerHTML = html;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function formatText(text) {
  if (!text) return '';
  // Bold
  text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
  // Newlines
  text = text.replace(/\n/g, '<br>');
  return text;
}

function showTyping() {
  const div = document.createElement('div');
  div.className = 'msg assistant';
  div.innerHTML = `
    <div class="msg-avatar">üß†</div>
    <div class="msg-body">
      <div class="msg-content">
        <div class="typing"><span></span><span></span><span></span></div>
      </div>
    </div>`;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
  return div;
}

// ‚ïê‚ïê‚ïê LIGHTBOX ‚ïê‚ïê‚ïê
function openLightbox(src) {
  lightboxImg.src = src;
  lightbox.classList.add('show');
}
lightbox.onclick = () => lightbox.classList.remove('show');
window.openLightbox = openLightbox;

// ‚ïê‚ïê‚ïê CLEAR ‚ïê‚ïê‚ïê
$('#clearBtn').onclick = async () => {
  if (!confirm('Clear all data and tables?')) return;
  await fetch(`${API}/api/clear`, { method: 'POST' });
  tablesList.innerHTML = '<div style="color:var(--text-muted);font-size:.78rem;padding:8px 0">No tables loaded yet</div>';
  messagesEl.innerHTML = '';
  hasData = false;
  chatInput.disabled = true;
  sendBtn.disabled = true;
  checkHealth();
};

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
checkHealth();
setInterval(checkHealth, 30000);
</script>
</body>
</html>
